{
  "launchType": "FARGATE",
  "deploymentController": {
    "type": "ECS"
  },
  "networkConfiguration": {
    "awsvpcConfiguration": {
      "subnets": [
        "{{ cfn_output `zenn-ecs-cdk-ecspresso` `PublicSubnet1` }}",
        "{{ cfn_output `zenn-ecs-cdk-ecspresso` `PublicSubnet2` }}"
      ],
      "securityGroups": [
        "{{ cfn_output `zenn-ecs-cdk-ecspresso` `ServiceSecurityGroupId` }}"
      ],
      "assignPublicIp": "ENABLED"
    }
  },
  "loadBalancers": [
    {
      "targetGroupArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `TargetGroupBlueArn` }}",
      "containerName": "app",
      "containerPort": 8000,
      "advancedConfiguration": {
        "alternateTargetGroupArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `TargetGroupGreenArn` }}",
        "productionListenerRule": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `ProductionListenerRuleArn` }}",
        "testListenerRule": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `TestListenerRuleArn` }}",
        "roleArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `EcsBlueGreenDeployRoleArn` }}"
      }
    }
  ],
  "deploymentConfiguration": {
    "bakeTimeInMinutes": 1,
    "deploymentCircuitBreaker": {
      "enable": false,
      "rollback": false
    },
    "lifecycleHooks": [
      {
        "hookTargetArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `BeforeInstallHookArn` }}",
        "lifecycleStages": [
          "PRE_SCALE_UP"
        ],
        "roleArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `EcsBlueGreenDeployRoleArn` }}"
      },
      {
        "hookTargetArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `AfterInstallHookArn` }}",
        "lifecycleStages": [
          "POST_SCALE_UP"
        ],
        "roleArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `EcsBlueGreenDeployRoleArn` }}"
      },
      {
        "hookTargetArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `BeforeAllowTrafficHookArn` }}",
        "lifecycleStages": [
          "TEST_TRAFFIC_SHIFT"
        ],
        "roleArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `EcsBlueGreenDeployRoleArn` }}"
      },
      {
        "hookTargetArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `AfterAllowTrafficHookArn` }}",
        "lifecycleStages": [
          "POST_PRODUCTION_TRAFFIC_SHIFT"
        ],
        "roleArn": "{{ cfn_output `zenn-ecs-cdk-ecspresso` `EcsBlueGreenDeployRoleArn` }}"
      }
    ],
    "maximumPercent": 200,
    "minimumHealthyPercent": 100,
    "strategy": "BLUE_GREEN"
  },
  "desiredCount": 1
}
